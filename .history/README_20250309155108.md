# ConnectionPool

> 本项目在Linux环境下基于queue队列容器，C++11多线程编程，生产者-消费者线程模型等构建了一个MySQL连接池，为了减少服务端访问MySQL数据库时在建立连接和关闭连接时的性能消耗。可以根据访问量的增大自动扩充连接池大小，也可以根据访问量的减少而缩小连接池。

## 项目特点

- MySQL数据库编程
- 单例模式
- queue队列容器
- C++11多线程编程
- 线程互斥
- 线程同步通信
- unique_lock
- 基于CAS的原子整型
- 智能指针shared_ptr
- lambda表达式
- 生产者-消费者线程模型

## 项目背景

- 为了提高MySQL数据库的访问瓶颈，除了在服务端增加缓存服务器缓存常用的数据之外，还可以增加连接池，来提高MySQL Server的访问效率。在高并发的情况下， 大量的TCP三次握手，MySQL Server连接认证，MySQL Server关闭连接回收资源和TCP四次挥手所消耗的性能时间很明显，增加连接池就是为了减少这一部分的性能。

## 功能点介绍

- **初始连接量（initSize）**：表示连接池会先和MySQL Server创建一个initSize个数的connection连接，当应用发起MySQL访问时，不用再创建和MySQL Server的新连接，直接从连接池中获取一个可用的连接就可以，使用完成之后，并不用去释放connection，而是把connection再归还到连接池中。
- **最大连接量（maxSize）**：当并发访问MySQL Server的请求增多时，初始连接量已经不够使用了，此时会根据新的请求数据去创建更多的连接给应用去使用，但新建立的连接数量上限是maxSize，不能无限制地创建连接，因为每一个连接都会占用一个socket资源，一般连接池和服务器程序是部署在一台主机上的，如果连接池占用过多地socket资源，那么服务器就不能接收太多的客户端请求了。
- **最大空闲时间（maxIdleTime）**：当访问MySQL的并发请求多了之后，连接池里面的连接数量就会动态增加，上线是maxSize个，当这些连接用完再回到连接池中，如果在指定的maxIleTime里面，这些新增加的连接都没有被再次使用过，那么新增加的这些连接资源就要被回收掉，只需要保持连接量initSize个连接就可以。
- **连接超时时间（connectionTimeout）**：当MySQL的并发请求量过大，连接池中的连接数量已经达到maxSize了，而此时没有空闲的连接可供使用，那么此时应用从连接池中获取连接无法成功，它通过阻塞的方式获取连接时的时间超过了connectionTimeout时间，那么获取连接失败，无法访问数据库。